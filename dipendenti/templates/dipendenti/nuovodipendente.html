{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Nuovo Dipendente{% endblock %}

{% block page_title %}Registrazione Nuovo Dipendente{% endblock %}

{% block content %}
<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-user-plus me-2"></i>Inserimento Nuovo Dipendente</h6>
        <a href="{% url 'dipendenti:elencodipendenti' %}" class="btn btn-secondary btn-sm">
            <i class="fas fa-arrow-left me-1"></i> Torna all'elenco
        </a>
    </div>
    <div class="card-body">
        <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            {% csrf_token %}
            
            <div class="row mb-4">
                <div class="col-12">
                    <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-key me-2"></i>Credenziali di Accesso</h5>
                </div>
                <div class="col-md-4">
                    {{ form.username|as_crispy_field }}
                </div>
                <div class="col-md-4">
                    {{ form.password1|as_crispy_field }}
                </div>
                <div class="col-md-4">
                    {{ form.password2|as_crispy_field }}
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-12">
                    <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-id-card me-2"></i>Dati Personali</h5>
                </div>
                <div class="col-md-3">
                    {{ form.first_name|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.last_name|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.email|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.telefono|as_crispy_field }}
                </div>
                <div class="col-md-6">
                    {{ form.indirizzo|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.data_nascita|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.data_assunzione|as_crispy_field }}
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-12">
                    <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-file-alt me-2"></i>Documenti</h5>
                </div>
                <div class="col-md-3">
                    {{ form.CF|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.carta_d_identità|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.data_scadenza_ci|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.patente_di_guida|as_crispy_field }}
                </div>
                <div class="col-md-2">
                    {{ form.data_scadenza_patente|as_crispy_field }}
                </div>
                <div class="col-md-2">
                    {{ form.categorie_patente|as_crispy_field }}
                </div>
                <div class="col-md-4">
                    {{ form.posizione_inail|as_crispy_field }}
                </div>
                <div class="col-md-4">
                    {{ form.posizione_inps|as_crispy_field }}
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-12">
                    <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-camera me-2"></i>Foto e Allegati</h5>
                </div>
                <div class="col-md-3">
                    {{ form.foto_dipendente|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.foto_carta_identità|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.foto_codice_fiscale|as_crispy_field }}
                </div>
                <div class="col-md-3">
                    {{ form.foto_patente|as_crispy_field }}
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-12">
                    <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-user-shield me-2"></i>Permessi</h5>
                </div>
                <div class="col-md-12">
                    {{ form.livello|as_crispy_field }}
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-12">
                    <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-sticky-note me-2"></i>Note</h5>
                </div>
                <div class="col-md-12">
                    {{ form.note|as_crispy_field }}
                </div>
            </div>
            
            <div class="row">
                <div class="col-12 text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save me-2"></i>Salva Dipendente
                    </button>
                    <a href="{% url 'dipendenti:elencodipendenti' %}" class="btn btn-secondary btn-lg ms-2">
                        <i class="fas fa-times me-2"></i>Annulla
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Attiva la validazione Bootstrap per il form
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            // Prendi tutti i form che necessitano di validazione
            var forms = document.getElementsByClassName('needs-validation');
            // Loop su di essi e previeni l'invio se non validi
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>
{% endblock %}