{% extends "base.html" %}
{% block title %}Eventi di {{ automezzo.targa }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Eventi – {{ automezzo.targa }}</h4>
    <a href="{% url 'automezzi:nuovo_evento' automezzo_pk=automezzo.pk %}" class="btn btn-success">
      <i class="fas fa-plus"></i> Nuovo evento
    </a>
  </div>

  {% if eventi %}
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>Data</th>
            <th>Tipo</th>
            <th>Descrizione</th>
            <th>Risolto</th>
            <th>Costo</th>
            <th>Allegato</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody>
          {% for e in eventi %}
          <tr>
            <td>{{ e.data_evento|date:"d/m/Y" }}</td>
            <td>{{ e.get_tipo_display }}</td>
            <td>{{ e.descrizione|truncatechars:40 }}</td>
            <td>
              {% if e.risolto %}
                <span class="badge bg-success">Sì</span>
              {% else %}
                <span class="badge bg-warning text-dark">No</span>
              {% endif %}
            </td>
            <td>{{ e.costo|floatformat:2 }} €</td>
            <td>
              {% if e.file_allegato %}
                <a href="{{ e.file_allegato.url }}" target="_blank">
                  <i class="fas fa-paperclip"></i>
                </a>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'automezzi:dettaglio_evento' automezzo_pk=automezzo.pk pk=e.pk %}" class="btn btn-sm btn-outline-primary" title="Dettaglio">
                <i class="fas fa-eye"></i>
              </a>
              <a href="{% url 'automezzi:modifica_evento' automezzo_pk=automezzo.pk pk=e.pk %}" class="btn btn-sm btn-outline-info" title="Modifica">
                <i class="fas fa-edit"></i>
              </a>
              {% if not e.risolto %}
                <a href="{% url 'automezzi:risolvi_evento' pk=e.pk %}" class="btn btn-sm btn-outline-warning" title="Marca come risolto">
                  <i class="fas fa-check"></i>
                </a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">Nessun evento registrato per questo automezzo.</div>
  {% endif %}
</div>
{% endblock %}