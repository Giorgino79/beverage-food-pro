{% extends "base.html" %}
{% load humanize %}
{% block title %}Report consumi – {{ stats.automezzo.targa }}{% endblock %}

{% block content %}
<div class="container py-4">
  <h4 class="mb-4"><i class="fas fa-chart-line"></i> Report consumi {{ stats.automezzo.targa }}</h4>
  <form method="get" class="row g-3 mb-4">
    <div class="col-auto">
      <label for="from_date" class="form-label mb-0">Da</label>
      <input type="date" id="from_date" name="from_date" value="{{ stats.from_date|date:'Y-m-d' }}" class="form-control">
    </div>
    <div class="col-auto">
      <label for="to_date" class="form-label mb-0">A</label>
      <input type="date" id="to_date" name="to_date" value="{{ stats.to_date|date:'Y-m-d' }}" class="form-control">
    </div>
    <div class="col-auto align-self-end">
      <button type="submit" class="btn btn-primary">Aggiorna</button>
    </div>
  </form>
  <div class="row mb-4">
    <div class="col-md-6">
      <ul class="list-group">
        <li class="list-group-item"><strong>Rifornimenti nel periodo:</strong> {{ stats.num_rifornimenti }}</li>
        <li class="list-group-item"><strong>Litri totali:</strong> {{ stats.litri_totali|floatformat:2 }} L</li>
        <li class="list-group-item"><strong>Km percorsi:</strong> {{ stats.km_percorsi|intcomma }} km</li>
        <li class="list-group-item"><strong>Consumo medio:</strong> {{ stats.consumo_medio|floatformat:2 }} L/100km</li>
        <li class="list-group-item"><strong>Costo totale:</strong> {{ stats.costo_totale|floatformat:2 }} €</li>
        <li class="list-group-item"><strong>Costo medio litro:</strong> {{ stats.costo_medio_litro|floatformat:3 }} €</li>
      </ul>
    </div>
    <div class="col-md-6">
      <!-- Qui puoi inserire un grafico usando Chart.js o altro, usando i dati di monthly_data -->
      <div class="alert alert-secondary">
        <em>Grafico consumi mensili da implementare</em>
      </div>
    </div>
  </div>
  <h5 class="mt-4">Rifornimenti dettagliati</h5>
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>Data</th>
          <th>Km</th>
          <th>Litri</th>
          <th>Costo tot.</th>
          <th>Costo/Litro</th>
          <th>Scontrino</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rifornimenti %}
        <tr>
          <td>{{ r.data_rifornimento|date:"d/m/Y" }}</td>
          <td>{{ r.chilometri|intcomma }}</td>
          <td>{{ r.litri|floatformat:2 }}</td>
          <td>{{ r.costo_totale|floatformat:2 }} €</td>
          <td>{{ r.costo_per_litro|floatformat:3 }} €</td>
          <td>
            {% if r.foto_scontrino %}
              <a href="{{ r.foto_scontrino.url }}" target="_blank">
                <img src="{{ r.foto_scontrino.url }}" alt="Scontrino" class="img-thumbnail" style="max-width:56px;">
              </a>
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}